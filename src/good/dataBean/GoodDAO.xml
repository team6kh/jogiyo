<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="Good">

	<!-- 별칭 지정 : 상품경로 -->
	<typeAlias alias="Good" type="good.dataBean.GoodDTO" />
	
	<!-- resultMap : 상품 객체에 테이블 정보 저장
	1. 상품분류 카테고리
	   상품분류코드, 대분류, 중분류, 소분류, 세분류, 세세분류
	   
	2. 상품목록 
	상품분류코드, 상품이미지(소), 상품이미지(대), 상품코드, 상품명, 판매가, 판매자, 제조사, 원산지, 배송정보, 보관유형
	 
	3. 게시판 
	글번호, 작성자, 조회수, 등록일
	4. 파일업로드
	-->
	<resultMap id="GoodRes" class="GoodDTO">	
		<result property="good_img_s" column="good_img_s" />
		<result property="good_img_b" column="good_img_b" />
		<result property="good_code" column="good_code" />
		<result property="good_name" column="good_name" />
		<result property="sell_price" column="sell_price" />
		<result property="good_seller" column="good_seller" />	
		<result property="mnft" column="mnft" />
		<result property="pbnc" column="pbnc" />
		<result property="reg_amount" column="reg_amount" />
		<result property="sell_amount" column="sell_amount" />	
		<result property="stock_amount" column="stock_amount" />	
		<result property="good_content" column="good_content" />	
		<result property="good_option" column="good_option" />	
		<result property="good_shp_info_content" column="good_shp_info_content" />	
		<result property="good_keep_type" column="good_keep_type" />
		<result property="shp_fee" column="shp_fee" />
		<result property="shp_fee_type" column="shp_fee_type" />
		<result property="good_reg_date" column="good_reg_date" />	
	</resultMap>	
	

	<!-- 데이터 범위 조건 정의 : 전체 상품테이블 -->
	<sql id="select-all">
		SELECT * FROM good_table
	</sql>
	
	<!-- 데이터 범위 조건 정의 :상품글번호 -->
	<sql id="where_good_num">
		WHERE good_num = #good_num#
	</sql>
	
	<!-- 데이터 범위 정의 : 상품코드 -->
	<sql id="where-good_code">
		WHERE good_code = #good_code#
	</sql>	
	
	<!-- 데이터 범위 조건 정의 : 상품명 -->
	<sql id="where-good_name">
		WHERE good_name = #good_name#
	</sql>
	
	<!-- 데이터 범위 조건 정의 : 재고수량이 3 이하일 경우 -->
	<sql id="where-good_amount">
		WHERE stock_amount <![CDATA[ <= ]]> 3  
	</sql>	
	
	
	<!-- SELECT : 해당 상품에 대한 글목록 추출 -->
	<select id="selectGoodList" resultMap="GoodResult" parameterClass="int">
		<include refid="select-all" />
		where Good_Table=#good_name# ORDER BY good_reg_date DESC
	</select>
	
<!-- SELECT
 ======================================================================= -->
 	<select id="goodList" resultClass="GoodDTO" parameterClass="java.util.HashMap">
		SELECT 	good_num, 
				good_category,	
				good_subject, 
				good_readcount,
				to_char(good_reg_date, 'YYYY-MM-DD HH24:MI') AS good_reg_date
		from good_board
		where 1=1 
		<isNotEmpty property="good_ctgy">
			and good_ctgy = #good_ctgy#
		</isNotEmpty>
		<isNotEmpty property="searchText">
			and (good_name like '%' || #searchText# || '%'
			or good_content like '%' || #searchText# || '%')
		</isNotEmpty>
		order by good_num desc
	</select>
	
	 
	<!-- 상품글번호로 상품글 하나 추출 -->
	<select id="selectGoodOne" resultClass="GoodDTO" >
		<include refid="select-all" />
		<include refid="where_good_num" />
	</select>

	<!-- 제일 마지막으로 작성된 상품의 번호 추출 -->
	<select id="selectLastNum" resultClass="GoodDTO">
		SELECT max(good_num) AS	good_num 
		FROM Good_Table
	</select>
	
	<!-- 품절상품코드 추출 -->
	<select id="selectEndSale" resultClass="GoodDTO">
		SELECT good_code
		FROM good_table
		WHERE good_seller=#session_id# AND reg_amount = #sell_amount#
	</select>	
	
	
	
	

		
<!-- INSERT : 쿼리문 정의
======================================================================= -->
	<insert id="insertGood" parameterClass="GoodDTO">
		INSERT INTO	good_table (
				good_seq,
				good_num,
				good_code,
				good_seller,
				good_ctgy,
				good_name,
				sell_price,
				mnft,
				pbnc,
				reg_amount,
				sell_amount,
				good_content,
				good_option,
				good_shp_info_content,
				good_keep_type,
				shp_fee,
				shp_fee_type,
				good_reg_date
			)
		VALUES(
				good_seq.nextval,
				#good_seq#,
				#good_num#,
				#good_code#,
				#good_seller#,
				#good_ctgy#,
				#good_name#,
				#sell_price#,
				#mnft#,
				#pbnc#,
				#reg_amount#,
				#sell_amount#,
				#good_content#,
				#good_option#,
				#good_shp_info_content#,
				#good_keep_type#,
				#shp_fee#,
				#shp_fee_type#,
				#good_reg_date#
		)
	</insert>
	

<!-- UPDATE
======================================================================= -->
	<!-- 사이트의 제공 서비스 : 판매자에게 상품 판매 진행 알림(재고량**개 이하 알림, 판매종료일 알림) -->
	<!-- 판매자의 상품관리 : 상품 등록수량, 상품상세, 판매가격 추가 및 변경 -->
	<update id="updateGoodAmount" parameterClass="goodDTO">
			UPDATE good_table
			SET reg_amount = #reg_amount#,
				good_content = #good_content#,
				sell_price = #sell_price#
			<include refid="where-good_amount" />
	</update>
	
	<!-- 판매자의 상품관리 : 상품정보(등록수량, 상품상세, 판매가격) 추가 및 변경 -->
	<update id="updateGood" parameterClass="goodDTO">
		UPDATE good_table
		SET reg_amount = #reg_amount#,
			good_content = #good_content#,
			sell_price = #sell_price#
		<include refid="where_good_num" />
	</update>

	<!-- 첨부파일 -->
	<update id="updateGoodFile" parameterClass="goodDTO">
		UPDATE good_table 
		SET GOOD_FILE = #good_file#
		<include refid="where_good_num" />
	</update>
	

<!-- DELETE  
======================================================================= -->
	<delete id="deleteGood">
		DELETE 
		FROM good_table
		<include refid="where_good_num" />
	</delete>
	
</sqlMap>
		