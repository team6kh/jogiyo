<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="Pay">

    
    
    
    

    <!-- 공통 정의  -->
    <sql id="selectAll">
        SELECT * FROM paid_board    
    </sql>
  
    
    <!-- 식당코드를 기준으로 rest_board 테이블(r)과 paid_board(p) join  -->
    <sql id="whereRest">
         from rest_board r,paid_board p  where rest_writer_id=#session_id# and rest_num=paid_rest_num
    </sql>
    
    
    <!-- 식당의 전체 결제 내역 :  식당번호/판매자id/결제번호/식당이름/메뉴명/메뉴가격/구매자id/주문결제일 -->
    <select id="payList">
        SELECT r.rest_num, r.rest_writer_id, p.paid_num, p.paid_rest_subject,p.paid_restopt_subject,p.paid_restopt_priceplus,p.session_id,p.paid_reg_date
        <include refid="whereRest"/>
    </select>
   
   <!-- 인기 메뉴 : 식당번호/판매자id/메뉴명/메뉴 매출건수/메뉴 총매출금-->
   <select id="hotmenu">
        SELECT r.rest_num, r.rest_writer_id,p.paid_restopt_subject, count(p.paid_num) as paid_sales_volume, 
        sum(p.paid_restopt_priceplus) as paid_sales_price
        <include refid="whereRest"/>
        GROUP BY p.paid_restopt_subject ORDER BY paid_sales_volume
   </select>
   
         
</sqlMap>