<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>


<sqlMap namespace="Paid">

	<typeAlias alias="paidDTO" type="board.paid.dto.PaidDTO"/>
	<typeAlias alias="menuDTO" type="board.paid.dto.MenuDTO"/>
	<typeAlias alias="searchDTO" type="board.paid.dto.SearchConditionDTO"/>
      
      
      <resultMap class="paidDTO" id="paidRes">
		<result property="paid_num" column="paid_num" />
		<result property="paid_rest_num" column="paid_rest_num" />
		<result property="paid_rest_subject" column="paid_rest_subject" />
		<result property="paid_restopt_subject" column="paid_restopt_subject" />
		<result property="paid_restopt_priceplus" column="paid_restopt_priceplus" />	
		<result property="session_id" column="session_id" />
		<result property="paid_reg_date" column="paid_reg_date" />   	
      </resultMap> 
      
      <resultMap class="menuDTO" id="menuRes">	     
	      <result property="paid_restopt_subject" column="paid_restopt_subject"/>
	      <result property="paid_sales_volume" column="paid_sales_volume"/>
	      <result property="paid_sales_price" column="paid_sales_price"/>
         
      </resultMap>


	<sql id="fromRPBoard">
		from rest_board r,paid_board p
	</sql>
	<sql id="whereRest">
    	where rest_writer_id = #session_id# and rest_num=paid_rest_num
    </sql>
    
    <sql id="paidDate">
        (paid_reg_date BETWEEN TO_DATE(#startDate#, 'yyyy-MM-dd') AND TO_DATE(#endDate#, 'yyyy-MM-dd')+0.99999) 
    </sql>
    
    <select id="paidList" resultMap="paidRes" parameterClass="searchDTO">
        SELECT 
			        	p.paid_rest_num, 			         
			        	p.paid_num, 
			        	p.paid_rest_subject,
			        	p.paid_restopt_subject,
			        	p.paid_restopt_priceplus,
			        	p.session_id,
			        	p.paid_reg_date 
        <include refid="fromRPBoard"/> 
        <include refid="whereRest"/> AND <include refid="paidDate"/>
        ORDER BY paid_reg_date DESC  	
    </select>
    
   <select id="hotmenu" resultMap="menuRes" parameterClass="searchDTO">          
        SELECT * FROM
  				(SELECT 
								paid_restopt_subject, 
								count(*) as paid_sales_volume, 
								sum(paid_restopt_priceplus) as paid_sales_price, 
								rownum as paid_rownum
  										
   				FROM 	paid_board 	
   				WHERE 	paid_rest_num = #rest_num# AND <include refid="paidDate"/> 
   				GROUP BY  paid_restopt_subject, rownum 
   				ORDER BY paid_sales_volume DESC) 

        WHERE  paid_rownum <![CDATA[>=]]> 1  AND paid_rownum <![CDATA[<=]]> 5
        		
   </select>
    
</sqlMap>