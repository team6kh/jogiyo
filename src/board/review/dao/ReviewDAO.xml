<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>


<sqlMap namespace="Review">

	<typeAlias alias="reviewDTO" type="board.review.dto.ReviewDTO" />

	<!-- 리절트맵 정의 -->
	<resultMap id="reviewRes" class="reviewDTO">
		<result property="review_num" column="review_num" />
		<result property="review_rest" column="review_rest" />
		<result property="review_writer" column="review_writer" />
		<result property="review_content" column="review_content" />
		<result property="review_file" column="review_file" />
		<result property="review_reg_date" column="review_reg_date" />
		<result property="review_rating" column="review_rating" />
	</resultMap>

	<!-- 공통으로 사용할 select절 정의 -->
	<sql id="select-all">
		SELECT * FROM Review_Board
	</sql>

	<!-- 공통으로 사용할 where_review_num절 정의 -->
	<sql id="where_review_num">
		WHERE review_num=#review_num#
	</sql>
	<!-- 공통으로 사용할 where_review_rest절 정의 -->
	<sql id="where_review_rest">
		where review_rest=#review_rest#
	</sql>


	<!-- SELECT 쿼리문 정의 -->

	<!-- 해당 식당에 관한 리뷰 글 목록 -->
	<select id="selectReviewAll" resultMap="reviewRes">
		<include refid="select-all" />
		where REVIEW_REST=#review_rest# ORDER BY REVIEW_REG_DATE
	</select>

	<select id="selectReviewOne" resultClass="reviewDTO">
		<include refid="select-all" />
		<include refid="where_review_num" />
	</select>

	<select id="selectLastNum" resultClass="reviewDTO">
		SELECT max(review_num) as review_num FROM Review_Board
	</select>

	<!-- INSERT 쿼리문 정의 -->
	<insert id="insertReview" parameterClass="reviewDTO">
		INSERT INTO Review_Board (
			review_num,
			review_rest,
			review_writer,
			review_content,
			review_reg_date,
			review_rating
		)
		VALUES(
			review_seq.nextval,
			#review_rest#,
			#review_writer#,
			#review_content#,
			#review_reg_date#,
			#review_rating#
		)
	</insert>

	<!-- UPDATE 쿼리문 정의 -->

	<!-- 첨부파일을 위한 쿼리문 -->
	<update id="updateReviewFile" parameterClass="reviewDTO">
		UPDATE review_board SET REVIEW_FILE=#review_file#
		<include refid="where_review_num" />
	</update>

	<!-- DELETE 쿼리문 정의 -->
	<delete id="deleteReview" parameterClass="reviewDTO">
		DELETE FROM review_board
		<include refid="where_review_num" />
	</delete>



</sqlMap>
