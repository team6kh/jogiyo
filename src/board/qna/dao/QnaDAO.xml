<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>

<sqlMap namespace="Qna">

	<typeAlias alias="qnaDTO" type="board.qna.dto.QnaDTO" />

	<!-- 리절트 맵 정의 -->
	<resultMap id="qnaRes" class="qnaDTO">
		<result property="qna_num" column="qna_num" />
		<result property="qna_id" column="qna_id" />
		<result property="qna_subject" column="qna_subject" />
		<result property="qna_content" column="qna_content" />
		<result property="qna_readcount" column="qna_readcount" />
		<result property="qna_reg_date" column="qna_reg_date" />
		<result property="qna_reply" column="qna_reply"/>
	</resultMap>

	<resultMap id="qnaRes2" class="qnaDTO">
		<result property="qna_num" column="qna_num" />
		<result property="qna_category" column="qna_category" />
		<result property="qna_subject" column="qna_subject" />
		<result property="qna_content" column="qna_content" />		
		<result property="qna_readcount" column="qna_readcount" />
		<result property="qna_reg_date" column="qna_reg_date" />
		<result property="qna_id" column="qna_id"/>
		<result property="qna_reply" column="qna_reply"/>
	</resultMap>

	<resultMap id="qndResTop" class="qnaDTO">
		<result property="qna_num" column="qna_num" />
		<result property="qna_category" column="qna_category" />		
		<result property="qna_subject" column="qna_subject" />
		<result property="qna_content" column="qna_content" />
		<result property="qna_reply" column="qna_reply"/>
	</resultMap>

	<select id="selectQnaList" resultClass="qnaDTO" parameterClass="java.util.HashMap">
		SELECT			
			qna_num,
			qna_category,
			qna_subject, 
			qna_readcount, 
			TO_CHAR(qna_reg_date, 'YYYY-MM-DD HH24:MI')	AS qna_reg_date,
			qna_id,
			qna_reply
		FROM qna_board
		WHERE 1 = 1 
		<isNotEmpty property="qna_category">
			AND qna_category = #qna_category#
		</isNotEmpty>
		<isNotEmpty property="searchText">
			AND (qna_subject LIKE '%' || #searchText# || '%'
				OR qna_content LIKE '%' || #searchText# || '%'
				OR qna_id LIKE '%' || #searchText# || '%')
		</isNotEmpty>
		ORDER BY qna_num DESC
	</select>

	<select id="selectTopQnaList" resultClass="qnaDTO">
		SELECT 
			ROWNUM AS qna_num, qna_content, qna_subject, qna_category, qna_reply
		FROM (
			SELECT 
			    qna_num, qna_content, qna_subject, qna_category, qna_reply
			FROM qna_board
			ORDER BY qna_readcount DESC
		)
		WHERE ROWNUM <![CDATA[ < ]]> 11
	</select>

	<select id="selectQnaDetail" parameterClass="int" resultMap="qnaRes2">
		SELECT * FROM qna_board
		WHERE qna_num = #qna_num#	
	</select>

	<insert id="insertQna" parameterClass="qnaDTO">
		INSERT INTO qna_board (qna_num, qna_subject, qna_content, qna_category, qna_reg_date, qna_id)
		VALUES
		(
			(SELECT NVL(MAX(qna_num) + 1, 1) FROM qna_board),
			#qna_subject#,
			#qna_content#,
			#qna_category#,
			SYSDATE,
			#qna_id#		
		)
	</insert>

	<update id="updateReadCount" parameterClass="int">
		UPDATE qna_board
		SET qna_readcount = (SELECT qna_readcount + 1
							FROM qna_board
							WHERE qna_num = #qna_num#)
		WHERE qna_num = #qna_num#
	</update>

	<update id="updateQna" parameterClass="qnaDTO">
		UPDATE qna_board
		SET qna_category = #qna_category#,
			qna_subject = #qna_subject#,
			qna_content = #qna_content#,
			qna_reply = #qna_reply#		
		WHERE qna_num = #qna_num#
	</update>

	<delete id="deleteQna" parameterClass="qnaDTO">
		DELETE qna_board WHERE qna_num = #qna_num#
	</delete>
	
	<!-- selectMyQnaList 쿼리문 정의 -->
	<select id="selectMyQnaList" resultMap="qnaRes2" parameterClass="java.lang.String">
		SELECT * FROM qna_board WHERE qna_id = #qna_id#
	</select>

</sqlMap>