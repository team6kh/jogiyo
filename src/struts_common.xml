<!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd">

<struts>	
	<package name="struts_common" extends="struts-default">

		<!-- SqlMapClient 인터셉터 -->
		<interceptors>
			<interceptor name="conDAO" class="common.ConDAOInterceptor"/>
		</interceptors>

		<!-- 로그인/로그아웃 -->

		<!-- 로그인 폼 -->
		<action name="loginForm" class="user.common.login.action.LoginAction" method="loginForm">
			<result>/user/common/login/loginForm.jsp</result>
		</action>

		<!-- 로그인 액션 -->
		<action name="login" class="user.common.login.action.LoginAction">
			<interceptor-ref name="chain"/>		
			<interceptor-ref name="params" />				
			<interceptor-ref name="conDAO" />
			<interceptor-ref name="servletConfig" />
			<result name="error">/common/error.jsp</result>
			<result name="success" type="redirect-action">${actionName}</result>
		</action>

		<!-- 로그아웃 액션 -->
		<action name="logout" class="user.common.logout.action.LogoutAction">
			<interceptor-ref name="chain"/>	
			<interceptor-ref name="servletConfig" />
			<result name="success" type="redirect-action">home</result>
		</action>
		
		<!-- 회원가입/수정/탈퇴 -->

		<!-- 회원가입 폼 -->
		<action name="registrationForm" class="user.common.registration.action.RegistrationFormAction">
			<result name="buyer">/user/buyer/regBuyerForm.jsp</result>
			<result name="seller">/user/seller/regSellerForm.jsp</result>
			<result>/user/buyer/regBuyerForm.jsp</result>
		</action>
		
		<!-- 아이디 중복체크 액션 -->		
		<action name="checkDup" class="user.common.registration.action.CheckDuplicateAction">
			<interceptor-ref name="params" />				
			<interceptor-ref name="conDAO" />
			<result>/user/common/registration/checkDup.jsp</result>
		</action>	

		<!-- 회원가입 액션 : 구매자, 판매자로 chain -->
		<action name="registration" class="user.common.registration.action.RegistrationAction">
			<result name="buyer" type="chain">regBuyer</result>
			<result name="seller" type="chain">regSeller</result>
			<result name="error">/common/error.jsp</result>
		</action>

		<!-- 구매자 가입 액션 -->
		<action name="regBuyer" class="user.buyer.action.RegBuyerAction">
			<interceptor-ref name="chain"/>
			<interceptor-ref name="prepare"/>
			<interceptor-ref name="modelDriven"/>
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result name="success" type="chain">
          		<param name="actionName">login</param>
        	</result>	
		</action>

		<!-- 판매자 가입 액션 -->
		<action name="regSeller" class="user.seller.action.RegSellerAction">
			<interceptor-ref name="chain"/>
			<interceptor-ref name="prepare"/>
			<interceptor-ref name="modelDriven"/>
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result name="success" type="chain">
          		<param name="actionName">login</param>
        	</result>	
		</action>
		
		<!-- 유저정보 액션 : 구매자, 판매자로 chain -->
		<action name="readUser" class="user.common.action.ReadUserAction">
			<result name="buyer" type="chain">readBuyer</result>
			<result name="seller" type="chain">readSeller</result>
			<result name="admin" type="redirect-action">dashAdmin</result>
			<result name="error">/common/error.jsp</result>
		</action>
		
		<!-- 구매자정보 읽기 액션 -->
		<action name="readBuyer" class="user.buyer.action.ReadBuyerAction">
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result>/user/buyer/readBuyer.jsp</result>
		</action>
		
		<!-- 판매자정보 읽기 액션 -->
		<action name="readSeller" class="user.seller.action.ReadSellerAction">
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result>/user/seller/readSeller.jsp</result>
		</action>
		
		<!-- 구매자정보 수정 폼 -->
		<action name="updateBuyerForm" class="user.buyer.action.UpdateBuyerAction" method="updateForm">
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result>/user/buyer/updateBuyerForm.jsp</result>
		</action>
		
		<!-- 구매자정보 수정 액션 -->
		<action name="updateBuyer" class="user.buyer.action.UpdateBuyerAction">
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result>/user/buyer/readBuyer.jsp</result>
		</action>
		
		<!-- 판매자정보 수정 폼 -->
		<action name="updateSellerForm" class="user.seller.action.UpdateSellerAction" method="updateForm">
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result>/user/seller/updateSellerForm.jsp</result>
		</action>
		
		<!-- 판매자정보 수정 액션 -->
		<action name="updateSeller" class="user.seller.action.UpdateSellerAction">
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result>/user/seller/readSeller.jsp</result>
		</action>
		
		<!-- 구매자정보 삭제(탈퇴) 액션 -->
		<action name="deleteBuyer" class="user.buyer.action.DeleteBuyerAction">
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result name="success" type="chain">
          		<param name="actionName">logout</param>
        	</result>	
		</action>
		
		<!-- 판매자정보 삭제(탈퇴) 액션 -->
		<action name="deleteSeller" class="user.seller.action.DeleteSellerAction">
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result name="success" type="chain">
          		<param name="actionName">logout</param>
        	</result>
		</action>
		
		<!-- HOME -->
		
		<!-- 홈 액션 -->
		<action name="home" class="board.home.action.HomeAction">
			<result>/index.jsp</result>
		</action>
		
		<!-- welocme 액션 -->
		<action name="welcome" class="board.home.action.HomeAction" method="welcome">
			<result>/common/welcome.jsp</result>
		</action>
		
		<!-- 공통기능(?) -->
		
		<!-- 이메일 인증 서비스 -->
		<action name="emailer" class="user.common.verification.action.Emailer">
			<result name="success" type="chain">
				<param name="actionName">insertEv</param>
			</result>
			<result name="error">/common/error.jsp</result>
		</action>
		
		<!-- 이메일 인증 요청 저장소 -->
		<action name="insertEv" class="user.common.verification.action.InsertEmailVerification">
			<param name="aliases">#{'to' : 'ev_requested'}</param>
			<interceptor-ref name="alias"/>	
			<interceptor-ref name="chain"/>					
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result name="success" type="redirect-action">
				<param name="actionName">readUser</param>
				<param name="user_type">${user_type}</param>
				<param name="user_id">${user_id}</param>
				<param name="actionStatus">evRequested</param>
			</result>
		</action>
		
		<!-- 이메일 인증 체크 -->
		<action name="checkEv" class="user.common.verification.action.CheckEmailVerification">
			<param name="aliases">#{'buyer_email' : 'ev_requested'}</param>
			<interceptor-ref name="alias"/>	
			<interceptor-ref name="chain"/>					
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result>/user/common/verification/checkEv.jsp</result>
		</action>
		
		<!-- NEW 비밀번호 체크 액션 -->
		<action name="checkPass" class="common.action.CheckPasswordAction">
			<interceptor-ref name="params"/>
			<interceptor-ref name="conDAO"/>
			<result name="success" type="chain">
				<param name="actionName">${modalParam}</param>
			</result>			
			<result name="error">/common/error.jsp</result>
		</action>			

	</package>
</struts>